<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlyHigh - Crash Game with PixiJS</title>
    <link rel="stylesheet" href="styles.css">
    <!-- PixiJS Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.3.2/pixi.min.js"></script>
    <style>
        /* Enhanced styles for auto-cashout section */
        .auto-cashout-section {
            display: none;
            /* margin-top: 10px;
            padding: 12px; */
            background: rgba(255, 255, 255, 0.05);
            /* border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1); */
            transition: all 0.3s ease;
        }
        
        .auto-cashout-section.show {
            /* display: block; */
        }
        
        .auto-cashout-section.enabled {
            /* background: rgba(0, 255, 0, 0.1);
            border-color: rgba(0, 255, 0, 0.3); */
        }
        
        .auto-cashout-checkbox {
            display: flex;
            align-items: center;
            /* margin-bottom: 8px; */
            cursor: pointer;
        }
        
        .auto-cashout-checkbox input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #00E5FF;
            border-radius: 50%;
            background: transparent;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .auto-cashout-checkbox input[type="checkbox"]:checked {
            /* background: #00E5FF;
            border-color: #00E5FF; */
        }
        
        .auto-cashout-checkbox input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: #00E5FF;
            border-radius: 50%;
        }
        
        .auto-cashout-checkbox label {
            color: #ffffff;
            font-size: 13px;
            cursor: pointer;
            user-select: none;
        }
        
        .auto-cashout-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            /* margin-top: 8px; */
        }
        
        .auto-cashout-input-group label {
            color: #fff;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .auto-cashout-input {
            flex: 1;
            /* padding: 6px 8px; */
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            /* border-radius: 4px; */
            color: #ffffff;
            /* font-size: 13px; */
            text-align: center;
        }
        
        .auto-cashout-input:focus {
            outline: none;
            border-color: rgba(0, 255, 0, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .auto-cashout-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Enhanced multiplier display styles */
        .multiplier-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            color: rgb(255, 255, 255);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            z-index: 100;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .multiplier-display.crashed {
            color: #ffffff !important;
            text-shadow: none !important;
            animation: flyAwayPulse 0.5s ease-in-out;
            font-size: 3.5rem;
            z-index: 200;
            font-family: 'Staatliches';
        }
        
        @keyframes flyAwayPulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        /* Enhanced game status styles */
        .game-status.crashed {
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
        }
        
        /* Enhanced bet mode toggle styles */
        .bet-mode-option {
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        
        .bet-mode-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .bet-mode-option input:disabled {
            cursor: not-allowed;
        }
        
        /* Enhanced countdown loader styles */
        .countdown-container {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translateX(-50%);
            /* background: rgba(0, 0, 0, 0.8); */
            padding: 20px 30px;
            /* border-radius: 12px; */
            /* border: 2px solid rgba(255, 255, 255, 0.2); */
            z-index: 150;
            min-width: 250px;
            text-align: center;
            /* backdrop-filter: blur(10px); */
        }
        
        .countdown-container.hidden {
            display: none !important;
        }
        
        .countdown-text {
            color: #ffffff;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 12px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        /* .countdown-bar-container {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        } */
        
        /* .countdown-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            border-radius: 3px;
            transition: width 0.1s linear;
            box-shadow: 0 0 8px rgba(0, 255, 136, 0.4);
        } */
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="left-header">
                <div class="menu-toggle" onclick="toggleSettingsSidebar()"></div>
                <div class="logo"></div>
            </div>
            <div class="user-info">
                <div class="user-name">
                    <div class="user-avatar-small" onclick="showAvatarModal()">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiMzMzMiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iI2ZmZiIvPgo8cGF0aCBkPSJNOCAzNGMwLTYuNjI3IDUuMzczLTEyIDEyLTEyczEyIDUuMzczIDEyIDEyIiBmaWxsPSIjZmZmIi8+Cjwvc3ZnPgo=" alt="User Avatar" id="headerUserAvatar">
                    </div>
                    <span id="userNameDisplay">Shreya</span>
                </div>
                <div class="balance"><span id="balance">5000.00</span></div>
                <a href="#" class="how-to-play" onclick="showGameRules()">HOW TO PLAY</a>
            </div>
        </div>

        <!-- Settings Sidebar -->
        <div class="settings-sidebar" id="settingsSidebar">
            <div class="settings-header">
                <div class="user-profile">
                    <div class="user-avatar" onclick="showAvatarModal()">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiMzMzMiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iI2ZmZiIvPgo8cGF0aCBkPSJNOCAzNGMwLTYuNjI3IDUuMzczLTEyIDEyLTEyczEyIDUuMzczIDEyIDEyIiBmaWxsPSIjZmZmIi8+Cjwvc3ZnPgo=" alt="User Avatar" id="currentUserAvatar">
                    </div>
                    <div class="user-details">
                        <div class="user-name">Naenn</div>
                    </div>
                    <button class="change-avatar-btn" onclick="showAvatarModal()">Change Avatar</button>
                </div>
            </div>
            
            <div class="settings-content">
                <div class="settings-section">
                    <div class="setting-item">
                        <span class="setting-label">Sound</span>
                        <div class="toggle-switch" onclick="toggleSound()">
                            <div class="toggle-slider" id="soundToggle"></div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <span class="setting-label">Music</span>
                        <div class="toggle-switch" onclick="toggleMusic()">
                            <div class="toggle-slider" id="musicToggle"></div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <span class="setting-label">Animation</span>
                        <div class="toggle-switch" onclick="toggleAnimation()">
                            <div class="toggle-slider" id="animationToggle"></div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-divider"></div>
                
                <div class="settings-section">
                    <div class="setting-link" onclick="showFreeBets()">Free Bets</div>
                    <div class="setting-link" onclick="showBetHistory()">My Bet History</div>
                    <div class="setting-link" onclick="showGameLimits()">Game Limits</div>
                    <div class="setting-link" onclick="showGameRules()">How to Play</div>
                    <div class="setting-link active" onclick="showGameRules()">Game Rules</div>
                    <div class="setting-link" onclick="showProvablyFair()">Provably Fair settings</div>
                    <div class="setting-link" onclick="showGameRoom()">Game Room: Room #2</div>
                </div>
            </div>
        </div>

        <!-- Game Rules Modal -->
        <div class="game-rules-modal" id="gameRulesModal">
            <div class="game-rules-content">
                <div class="game-rules-header">
                    <h2 class="game-rules-title">Game Rules</h2>
                    <button class="close-btn" onclick="closeGameRules()">×</button>
                </div>
                
                <div class="game-rules-body">
                    <p class="game-intro">
                        Aviator is a new generation of Igaming entertainment. You can win many times more. In essence Aviator is built on a provably fair system which is currently the only guarantee of honesty in the gambling industry.
                    </p>
                    
                    <h3 class="how-to-play-title">How to Play</h3>
                    
                    <div class="game-video-placeholder">
                        <!-- Placeholder for game video/animation -->
                    </div>
                    
                    <p class="steps-intro">Aviator is as easy to play as 1-2-3:</p>
                    
                    <div class="steps-container">
                        <div class="step-item">
                            <div class="step-number">01</div>
                            <div class="step-video-placeholder"></div>
                            <p class="step-text">BET before take off</p>
                        </div>
                        
                        <div class="step-item">
                            <div class="step-number">02</div>
                            <div class="step-video-placeholder"></div>
                            <p class="step-text">Watch as your lucky plane takes off and your winnings increase.</p>
                        </div>
                        
                        <div class="step-item">
                            <div class="step-number">03</div>
                            <div class="step-video-placeholder"></div>
                            <p class="step-text">Cash out before the plane disappears and wins X times more!</p>
                        </div>
                    </div>
                    
                    <p class="game-conclusion">
                        But remember, if you did not have time to cash out before the lucky plane flies away, your bet will be lost. Aviator is pure excitement! Risk and win, its all in your hands!
                    </p>
                </div>
            </div>
        </div>

        <!-- My Bet History Modal -->
        <div class="bet-history-modal" id="betHistoryModal">
            <div class="bet-history-content">
                <div class="bet-history-header">
                    <h2 class="bet-history-title">My Bet History</h2>
                    <button class="close-btn" onclick="closeBetHistory()">×</button>
                </div>
                
                <div class="bet-history-body">
                    <div class="bet-history-table">
                        <div class="bet-history-headers">
                            <div class="header-date">Date</div>
                            <div class="header-bet">Bet INR X</div>
                            <div class="header-cashout">Cash out INR</div>
                        </div>
                        
                        <div class="bet-history-entries" id="betHistoryEntries">
                            <!-- Bet entries will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Avatar Selection Modal -->
        <div class="avatar-modal" id="avatarModal">
            <div class="avatar-content">
                <div class="avatar-header">
                    <h2 class="avatar-title">Select Avatar</h2>
                    <button class="close-btn" onclick="closeAvatarModal()">×</button>
                </div>
                
                <div class="avatar-grid" id="avatarGrid">
                    <!-- Avatar options will be populated here -->
                </div>
            </div>
        </div>

        <!-- Black Overlay -->
        <div class="menu-overlay" id="menuOverlay"></div>



        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-title">MY BETS</div>
                <div class="bet-headers">
                    <div>BET X</div>
                    <div>CASHOUT</div>
                </div>
                <div class="bet-list" id="betList">
                    <!-- Bet history will be populated here -->
                </div>
            </div>

            <!-- Game Area -->
            <div class="game-area">
                <div style="opacity: 0;" class="game-status" id="gameStatus">Connecting...</div>
                
                <div class="game-canvas" id="gameCanvas">                    
                    <!-- History Trail inside game canvas -->
                    <div class="history-trail-ingame" id="historyTrailInGame">
                        <div class="history-items-compact" id="historyItems">
                            <!-- History items will be populated here -->
                        </div>
                        <button class="history-expand-btn" onclick="toggleHistoryExpansion()">
                            <img src="./assets/images/history-grey.svg" alt="History" style="width: 16px; height: 16px;">
                             <span>HISTORY</span>
                        </button>
                    </div>
                    
                    <!-- Game Logo - shows during pause state -->
                    <div class="game-logo" id="gameLogo"></div>
                    
                    <!-- Countdown Container - positioned below game logo -->
                    <div class="countdown-container hidden" id="countdownContainer">
                        <div class="countdown-text" id="countdownText">Accepting bets - 5.0s</div>
                        <div class="countdown-bar-container">
                            <div class="countdown-bar" id="countdownBar"></div>
                        </div>
                    </div>
                    
                    <!-- Multiplier Display - shows during game -->
                    <div class="multiplier-display" id="multiplierDisplay">1.00x</div>
                    
                    <!-- PixiJS Canvas will be inserted here automatically -->
                    
                    <!-- Legacy DOM elements for fallback (hidden when PixiJS is active) -->
                    <div class="trail-container" id="trailContainer" style="display: none;">
                        <!-- Trail segments will be dynamically created -->
                    </div>
                    
                    <!-- Legacy Rocket with PNG Image (hidden when PixiJS is active) -->
                    <div class="rocket" id="rocket" style="display: none;">
                        <img src="./assets/images/fly.png" alt="Rocket" class="rocket-image">
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="control-panel">
                    <!-- First Bet Section -->
                    <div class="bet-section">
                        <div class="bet-spot">
                            <div class="bet-options">
                                <div class="bet-mode-toggle">
                                    <label class="bet-mode-option">
                                        <input type="radio" name="betMode1" value="bet" checked onchange="setBetMode('bet', 1)">
                                        <span>BET</span>
                                    </label>
                                    <label class="bet-mode-option">
                                        <input type="radio" name="betMode1" value="auto" onchange="setBetMode('auto', 1)">
                                        <span>AUTO</span>
                                    </label>
                                </div>
                                
                                <div class="auto-cashout-section" id="autoCashoutSection1">
                                    <div class="auto-cashout-checkbox">
                                        <input type="checkbox" id="autoCashoutCheckbox1" onchange="toggleAutoCashout(1)">
                                    </div>
                                    
                                    <div class="auto-cashout-input-group">
                                        <label for="autoCashoutValue1">AUTO CASH OUT</label>
                                        <input type="number" class="auto-cashout-input" id="autoCashoutValue1" value="1.10" step="0.01" min="1.01" onchange="updateAutoCashout(1)" disabled>
                                        <span style="color: #cccccc; font-size: 12px;">X</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bet-controls">
                                <div class="bet-amount-container">
                                    <div class="bet-amount-display">
                                        <button class="bet-adjust-btn" onclick="adjustBet(0.5, 1)">-</button>
                                        <input type="number" class="bet-amount-input" id="betAmount1" value="100.00" min="1" step="0.01">
                                        <button class="bet-adjust-btn" onclick="adjustBet(2, 1)">+</button>
                                    </div>
                                    
                                    <div class="bet-presets">
                                        <button class="preset-btn" onclick="setBetAmount(100, 1)">100.00</button>
                                        <button class="preset-btn" onclick="setBetAmount(200, 1)">200.00</button>
                                        <button class="preset-btn" onclick="setBetAmount(500, 1)">500.00</button>
                                        <button class="preset-btn" onclick="setBetAmount(1000, 1)">1000.00</button>
                                    </div>
                                </div>
                                
                                <div class="bet-btn">
                                    <button class="main-action-button bet-state" id="mainActionButton1" onclick="handleMainAction(1)">
                                        <span class="button-label">BET</span>
                                        <span class="button-amount"><span id="mainButtonAmount1">100.00</span></span>
                                    </button>    
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Second Bet Section -->
                    <div class="bet-section">
                        <div class="bet-spot">
                            <div class="bet-options">
                                <div class="bet-mode-toggle">
                                    <label class="bet-mode-option">
                                        <input type="radio" name="betMode2" value="bet" checked onchange="setBetMode('bet', 2)">
                                        <span>BET</span>
                                    </label>
                                    <label class="bet-mode-option">
                                        <input type="radio" name="betMode2" value="auto" onchange="setBetMode('auto', 2)">
                                        <span>AUTO</span>
                                    </label>
                                </div>
                                
                                <div class="auto-cashout-section" id="autoCashoutSection2">
                                    <div class="auto-cashout-checkbox">
                                        <input type="checkbox" id="autoCashoutCheckbox2" onchange="toggleAutoCashout(2)">
                                    </div>
                                    
                                    <div class="auto-cashout-input-group">
                                        <label for="autoCashoutValue2">AUTO CASH OUT</label>
                                        <input type="number" class="auto-cashout-input" id="autoCashoutValue2" value="1.10" step="0.01" min="1.01" onchange="updateAutoCashout(2)" disabled>
                                        <span style="color: #cccccc; font-size: 12px;">x</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bet-controls">
                                <div class="bet-amount-container">
                                    <div class="bet-amount-display">
                                        <button class="bet-adjust-btn" onclick="adjustBet(0.5, 2)">-</button>
                                        <input type="number" class="bet-amount-input" id="betAmount2" value="100.00" min="1" step="0.01">
                                        <button class="bet-adjust-btn" onclick="adjustBet(2, 2)">+</button>
                                    </div>
                                    
                                    <div class="bet-presets">
                                        <button class="preset-btn" onclick="setBetAmount(100, 2)">100.00</button>
                                        <button class="preset-btn" onclick="setBetAmount(200, 2)">200.00</button>
                                        <button class="preset-btn" onclick="setBetAmount(500, 2)">500.00</button>
                                        <button class="preset-btn" onclick="setBetAmount(1000, 2)">1000.00</button>
                                    </div>
                                </div>
                                
                                <div class="bet-btn">
                                    <button class="main-action-button bet-state" id="mainActionButton2" onclick="handleMainAction(2)">
                                        <span class="button-label">BET</span>
                                        <span class="button-amount"><span id="mainButtonAmount2">100.00</span></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Toast Messages -->
        <div class="toast" id="toast"></div>
        
        <!-- Black Blanket Overlay -->
        <div class="blanket-overlay" id="blanketOverlay"></div>
    </div>

    <!-- Audio Elements -->
    <audio id="bgMusic" loop preload="auto">
        <source src="./assets/sounds/bgmusic.mp3" type="audio/mpeg">
    </audio>
    <audio id="crashSound" preload="auto">
        <source src="./assets/sounds/box-crash.mp3" type="audio/mpeg">
    </audio>
    <audio id="cashoutSound" preload="auto">
        <source src="./assets/sounds/cashout.mp3" type="audio/mpeg">
    </audio>
    <audio id="planeSound" loop preload="auto">
        <source src="./assets/sounds/plan.mp3" type="audio/mpeg">
    </audio>

    <!-- GSAP Animation Library (for UI animations) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <!-- Load PixiJS Rocket Animation System first -->
    <script src="pixiRocketAnimation.js"></script>
    
    <!-- Sound Manager -->
    <script src="soundManager.js"></script>
    
    <!-- Main Game Script -->
    <script src="script.js"></script>
    
    <script>
        // Enhanced auto-cashout functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Setup auto-cashout checkbox handlers
            const setupAutoCashoutHandlers = (playerIndex) => {
                const checkbox = document.getElementById(`autoCashoutCheckbox${playerIndex}`);
                const input = document.getElementById(`autoCashoutValue${playerIndex}`);
                
                if (checkbox && input) {
                    // Enable/disable input based on checkbox
                    checkbox.addEventListener('change', function() {
                        input.disabled = !this.checked;
                        
                        // Update visual feedback
                        const section = document.getElementById(`autoCashoutSection${playerIndex}`);
                        if (section) {
                            section.classList.toggle('enabled', this.checked);
                        }
                        
                        // Call the game function
                        if (typeof toggleAutoCashout === 'function') {
                            toggleAutoCashout(playerIndex);
                        }
                    });
                    
                    // Initial state
                    input.disabled = !checkbox.checked;
                }
            };
            
            // Setup for both players
            setupAutoCashoutHandlers(1);
            setupAutoCashoutHandlers(2);
        });
        
        // PixiJS Integration Status Display (for debugging)
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.rocketAnimation && window.rocketAnimation.getState) {
                    const state = window.rocketAnimation.getState();
                    console.log('🎮 Animation System Status:', {
                        system: state.usingFallback ? 'DOM (Fallback)' : 'PixiJS (Canvas)',
                        pixiVersion: typeof PIXI !== 'undefined' ? PIXI.VERSION : 'Not loaded',
                        ready: !state.usingFallback,
                        tabVisible: state.tabVisible
                    });
                }
            }, 1000);
        });
        
        // Performance monitoring
        let frameCount = 0;
        let lastTime = performance.now();
        
        function monitorPerformance() {
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime - lastTime >= 5000) { // Every 5 seconds
                const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                console.log(`📊 Performance: ${fps} FPS`);
                
                if (window.rocketAnimation && window.rocketAnimation.getState) {
                    const state = window.rocketAnimation.getState();
                    console.log('🚀 Animation State:', {
                        active: state.isActive,
                        multiplier: state.multiplier?.toFixed(2),
                        trailParticles: state.trailParticles,
                        tabVisible: state.tabVisible,
                        pendingAnimations: state.pendingAnimations
                    });
                }
                
                frameCount = 0;
                lastTime = currentTime;
            }
            
            requestAnimationFrame(monitorPerformance);
        }
        
        // Start performance monitoring in development
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            requestAnimationFrame(monitorPerformance);
        }
        
        // Sidebar positioning for mobile
        function handleSidebarPosition() {
            const sidebar = document.getElementById('sidebar');
            const container = document.querySelector('.container');
            const mainContent = document.querySelector('.main-content');
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                // Move sidebar to be 3rd child of container (after header, main-content)
                if (sidebar.parentElement !== container) {
                    container.appendChild(sidebar);
                }
                // Ensure sidebar is hidden by default on mobile
                sidebar.classList.remove('hidden');
                if (!sidebar.classList.contains('visible')) {
                    // Keep it collapsed initially
                }
            } else {
                // Move sidebar back to main-content for desktop
                if (sidebar.parentElement !== mainContent) {
                    mainContent.insertBefore(sidebar, mainContent.firstChild);
                }
                // Remove mobile classes and ensure it's visible on desktop
                sidebar.classList.remove('visible');
                sidebar.classList.remove('hidden');
            }
        }
        
        // Initial positioning
        handleSidebarPosition();
        
        // Handle window resize
        window.addEventListener('resize', handleSidebarPosition);
        

        
        // Toggle sidebar function (for desktop or other uses)
        window.toggleSidebar = function() {
            const sidebar = document.getElementById('sidebar');
            const isMobile = window.innerWidth <= 768;
            
            console.log('toggleSidebar called', { isMobile, sidebar: !!sidebar });
            
            if (sidebar) {
                if (isMobile) {
                    sidebar.classList.toggle('visible');
                    console.log('Mobile: toggled visible class', sidebar.classList.contains('visible'));
                } else {
                    sidebar.classList.toggle('hidden');
                    console.log('Desktop: toggled hidden class', sidebar.classList.contains('hidden'));
                }
            }
        };
        
        window.toggleHistoryExpansion = function() {
            const historyTrail = document.getElementById('historyTrailInGame');
            console.log('toggleHistoryExpansion called', { historyTrail: !!historyTrail });
            
            if (historyTrail) {
                historyTrail.classList.toggle('expanded');
                console.log('Toggled expanded class', historyTrail.classList.contains('expanded'));
            }
        };
    </script>

    <!-- Game Launch Loading Screen -->
    <div class="game-loader-overlay" id="gameLoaderOverlay" style="display: flex;">
        <div class="game-loader-content">
            <div class="loader-logo">
                <span class="logo-diamond"></span>
                <span class="logo-text">flairstudioz</span>
            </div>
            <div class="loader-progress-container">
                <div class="loader-progress-bar">
                    <div class="loader-progress-fill" id="loaderProgressFill"></div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>